---

title:                 "Creating New Workflow Bundles and Modules Using Maven Archetypes"
toc_includes_sections: true
markdown:              basic

---


The SeqWare workflow archetype and module archetype allow workflow developers to quickly create workflows and modules. The Maven archetypes generate skeletons (of workflows or modules) that contain a simple example program that can be modified to create a new workflow or module. The archetypes also take parameters prior to skeleton generation that allow the name of the workflow or module to be specified and all configuration files to adjusted with respect to these parameters.

The code generated by the archetype contains all the necessary files to generate a complete workflow bundle or module when the <tt>mvn install</tt> command is issued. This command will combine the .ini file and the user created Java file with other external dependencies pulled in by Maven to create a complete workflow bundle or module. This makes the code  generated by the archetype ideal to place under version control. As maintenance changes are made to the Java file or any other aspect of the workflow, these files can be updated and a new workflow reflecting these changes can be generated by re-issuing the  <tt>mvn install</tt> command.

##Installation


The Maven archetypes are part of SeqWare and are automatically installed when the SeqWare source is checked out and compiled with the <tt>mvn install</tt> command.

	$ cd  /home/seqware/seqware-github-development 
	$ mvn clean install

If you are working on a development version and encounter errors, you can skip tests by issuing the following command:

	$ mvn install -Dmaven.test.skip=true
 	
 	
##Usage


The rest of this tutorial was performed on a development version of the SeqWare CentOS VM using 0.13.6-SNAPSHOT. Change to a directory where you want to create a new workflow bundle.

	$ cd /home/seqware/SeqWare  
	$ mkdir maven-bundles 
	$ cd maven-bundles 

Run the command to create a new workflow or module skeleton. The new code will be placed in a child directory.

	$ mvn archetype:generate
	...
	62: local -> com.github.seqware:seqware-archetype-java-workflow (SeqWare Java workflow archetype)
	63: local -> com.github.seqware:seqware-archetype-ftl-workflow (SeqWare FTL workflow archetype)
	64: local -> com.github.seqware:seqware-archetype-module (SeqWare module archetype)
	65: local -> com.github.seqware:seqware-archetype-workflow (SeqWare workflow archetype)
	66: local -> com.github.seqware:seqware-archetype-simple-workflow (A very simple SeqWare workflow archetype)
	Choose a number or apply filter (format: [groupId:]artifactId, case sensitive contains): 16:

The numbers used to identify  the archetypes (62 through 66) will vary, so you will need to scan through the list to find the SeqWare archetype you're looking for.

62: if you want to write your workflow using Java objects.

63: if you want to write your workflow using FTL.

### SeqWare WorkflowV2 Archetype

In order to work on workflows that use the Java simplified workflow, use 62. Use the following options:

	Choose a number or apply filter (format: [groupId:]artifactId, case sensitive contains): 16: 62
	Define value for property 'groupId': : net.sf.seqware
	Define value for property 'artifactId': : helloworld
	Define value for property 'version': 1.0-SNAPSHOT: 1.0
	Define value for property 'package': net.sf.seqware:
	Define value for property 'workflowDirectoryName': : helloworld
	Define value for property 'workflowName': : helloworld
	Define value for property 'workflowVersion': : 1.0
	Confirm properties configuration:
	groupId: net.sf.seqware
	artifactId: helloworld
	version: 1.0
	package: net.sf.seqware
	workflowDirectoryName: helloworld
	workflowName: helloworld
	workflowVersion: 1.0
	Y: Y
	[INFO] ----------------------------------------------------------------------------
	[INFO] Using following parameters for creating project from Archetype: seqware-archetype-java-workflow:0.13.6-SNAPSHOT
	[INFO] ----------------------------------------------------------------------------
	[INFO] Parameter: groupId, Value: net.sf.seqware
	[INFO] Parameter: artifactId, Value: helloworld
	[INFO] Parameter: version, Value: 1.0
	[INFO] Parameter: package, Value: net.sf.seqware
	[INFO] Parameter: packageInPathFormat, Value: net/sf/seqware
	[INFO] Parameter: package, Value: net.sf.seqware
	[INFO] Parameter: version, Value: 1.0
	[INFO] Parameter: workflowName, Value: helloworld
	[INFO] Parameter: groupId, Value: net.sf.seqware
	[INFO] Parameter: workflowDirectoryName, Value: helloworld
	[INFO] Parameter: workflowVersion, Value: 1.0
	[INFO] Parameter: artifactId, Value: helloworld
	[INFO] project created from Archetype in dir: /home/seqware/SeqWare/maven-bundles/helloworld
	[INFO] ------------------------------------------------------------------------
	[INFO] BUILD SUCCESSFUL
	[INFO] ------------------------------------------------------------------------
	[INFO] Total time: 4 minutes 35 seconds
	[INFO] Finished at: Fri Nov 23 14:45:24 EST 2012
	[INFO] Final Memory: 23M/166M
	[INFO] ------------------------------------------------------------------------


Note the following conventions:

* groupId
: The workflow belongs to this group. This group id is part of the workflow's unique identity.
* artifactId
: The specific name of the workflow. Also part of the workflow's unique identity. This will also be used as the name of the directory containing all the files associated with this workflow.
* version
: The version of this workflow. Again, part of the workflow's unique identity. When maintaining the code in the future it will be possible to update this value.
* package
: This is a java package name. In the context of creating a workflow this is not used. Just press enter.
* workflowDirectoryName
: A unique workflow directory name. No spaces. All lowercase, separated by underscores.
* workflowName
: A unique camel case workflow name.

<!-- this explicit pre tag should be avoided, but the automatic nanoc formatting does not 
seem to work here -->
<pre>
	$ cd workflow-helloworld-example
	$ ls
	pom.xml src workflow  workflow.properties
</pre>

* pom.xml
: A maven project file. Edit this to change the version of the workflow and to add or modify workflow dependencies such as program, modules and data.
* workflow
: This directory contains the workflow skeleton. Look in here to modify the workflow .ini, .java files (Java workflow) or workflow.ftl(FTL workflow). The examples of Java and FTL can be found <a href="/docs/15-workflow-examples/">here</a>.
* src 
: This directory contains the Java client. Look in here to modify the .java files (Java workflow). The examples of Java and FTL can be found <a href="/docs/15-workflow-examples/">here</a>.
* workflow.properties
: You can edit the description and workflow names in this file.

#### Variables

Automatically Defined

* ${date}: a string representing the date the DAX was created, this is always defined so consider this a reserved variable name. 

* ${random}: a randomly generated string, this is always defined so consider this a reserved variable name. 

* ${workflow_bundle_dir}: if this workflow is part of a workflow bundle this variable will be defined and points to the path of the root of the directory this workflow bundle has been expanded to. 

* ${workflow_base_dir}: ${workflow_bundle_dir}/Workflow_Bundle_{workflow_name}/{workflow_version}

## Building the Workflow

The archetype is just a template for the workflow bundle.  You need to use "mvn install" to actually build the workflow bundle.

	[seqware@seqwarevm maven-bundles]$ cd helloworld/
	[seqware@seqwarevm helloworld]$ mvn install
	[INFO] Scanning for projects...                                                                                       
	[INFO] ------------------------------------------------------------------------                                       
	[INFO] Building seqware-workflow                                                                                      
	[INFO]    task-segment: [install]                                                                                     
	[INFO] ------------------------------------------------------------------------                                       
	[INFO] [properties:read-project-properties {execution: properties-maven-plugin-execution}]                            
	[debug] execute contextualize                                                                                         
	[INFO] [resources:copy-resources {execution: copy-resources}]                                                         
	[INFO] Using 'UTF-8' encoding to copy filtered resources.                                                             
	[INFO] Copying 3 resources                                                                                            
	[debug] execute contextualize                                                                                         
	[INFO] [resources:resources {execution: default-resources}]                                                           
	[INFO] Using 'UTF-8' encoding to copy filtered resources.    
	...
	main:
	[INFO] Executed tasks
	[INFO] [antrun:run {execution: chmod-perl}]
	[INFO] Executing tasks

	main:
	[INFO] Executed tasks
	[INFO] ------------------------------------------------------------------------
	[INFO] BUILD SUCCESSFUL
	[INFO] ------------------------------------------------------------------------
	[INFO] Total time: 26 seconds
	[INFO] Finished at: Fri Nov 23 14:48:15 EST 2012
	[INFO] Final Memory: 67M/423M
	[INFO] ------------------------------------------------------------------------

At this junction, one would normally want to edit the workflow by modifying the WorkflowClient. However, since this just an example we will proceed onto testing.

##Testing the Workflow

You can first get an idea of what parameters are needed by displaying the help message

	[seqware@seqwarevm maven-bundles]$ java -jar helloworld/target/Workflow_Bundle_helloworld_1.0_SeqWare_0.13.6-SNAPSHOT/Workflow_Bundle_helloworld/1.0/lib/seqware-distribution-0.13.6-SNAPSHOT-full.jar --plugin net.sourceforge.seqware.pipeline.plugins.WorkflowLauncherV2 -- --help
	Running Plugin: net.sourceforge.seqware.pipeline.plugins.WorkflowLauncherV2
	Setting Up Plugin: net.sourceforge.seqware.pipeline.plugins.WorkflowLauncherV2@2fcac6db
	Option                                  Description                                    
	------                                  -----------                                    
	-?, -h, --help                          Provides this help message.                    
	-b, --bundle, --provisioned-bundle-dir  The path to a bundle zip file. You can         
						  specify this or the workflow-                
						  accession of an already installed            
						  bundle.                                      
	--host                                  If specified, the scheduled workflow           
						  will only be launched if this                
						  parameter value and the host field           
						  in the workflow run table match.             
						  This is a mechanism to target                
						  workflows to particular servers for          
						  launching.                     
	...

You can then test the workflow with:

	[seqware@seqwarevm maven-bundles]$ java -jar helloworld/target/Workflow_Bundle_helloworld_1.0_SeqWare_0.13.6-SNAPSHOT/Workflow_Bundle_helloworld/1.0/lib/seqware-distribution-0.13.6-SNAPSHOT-full.jar --plugin net.sourceforge.seqware.pipeline.plugins.WorkflowLauncherV2 -- --provisioned-bundle-dir /home/seqware/SeqWare/maven-bundles/helloworld/target/Workflow_Bundle_helloworld_1.0_SeqWare_0.13.6-SNAPSHOT --workflow helloworld --version 1.0 --ini-files helloworld/target/Workflow_Bundle_helloworld_1.0_SeqWare_0.13.6-SNAPSHOT/Workflow_Bundle_helloworld/1.0/config/workflow.ini --wait
	Running Plugin: net.sourceforge.seqware.pipeline.plugins.WorkflowLauncherV2
	Setting Up Plugin: net.sourceforge.seqware.pipeline.plugins.WorkflowLauncherV2@4d865b28
	  INI FILE: helloworld/target/Workflow_Bundle_helloworld_1.0_SeqWare_0.13.6-SNAPSHOT/Workflow_Bundle_helloworld/1.0/config/workflow.ini
	CREATING DAX IN: /tmp/dax5419643624422120164178112195381539
	SUBMITTING TO PEGASUS: pegasus-plan -Dpegasus.user.properties=/home/seqware/.seqware/pegasus/properties --dax /tmp/dax5419643624422120164178112195381539 --dir /home/seqware/SeqWare/pegasus-dax -o seqwarevm --force --submit -s seqwarevm
	PEGASUS STATUS COMMAND: pegasus-status -l /home/seqware/SeqWare/pegasus-dax/seqware/pegasus/helloworld/run0002
	MONITORING PEGASUS STATUS:
	RUNNING: step 1 of 7 (14%)
	RUNNING: step 2 of 7 (28%)
	RUNNING: step 3 of 7 (42%)
	RUNNING: step 4 of 7 (57%)
	RUNNING: step 5 of 7 (71%)
	RUNNING: step 6 of 7 (85%)
	WORKFLOW COMPLETED SUCCESSFULLY!
	You have new mail in /var/spool/mail/seqware
	[seqware@seqwarevm maven-bundles]$

This ends the tutorial on creating new workflows using Maven archetypes. 
The next step is to look at examples of workflows at [Workflow Examples](/docs/15-workflow-examples/).
