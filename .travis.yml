notifications:
  slack: oicr:S9k4EowgQv9AnbCfEZHSzCsg
language: java
jdk:
  - oraclejdk8

cache:
  directories:
  - $HOME/.m2

services:
  - docker

# encryption used for documentation key
before_install:
- docker pull seqware/seqware_test_environment:after_hiatus
- openssl aes-256-cbc -K $encrypted_b1a0a7dd1d17_key -iv $encrypted_b1a0a7dd1d17_iv -in id_seqware-jenkins-docker.enc -out id_seqware-jenkins-docker -d

script: 
- docker run -h master -ti --rm -v $HOME/.m2:/home/seqware/.m2 -v $TRAVIS_BUILD_DIR:/home/seqware/gitroot/seqware seqware/seqware_test_environment:after_hiatus /test-start.sh "cd /home/seqware && sudo chown -R seqware:seqware . && cd /home/seqware/gitroot/seqware && cp .travis/settings ~/.seqware  && export MAVEN_OPTS=\"-Xmx2048m -XX:MaxPermSize=1024m\" && mvn -B clean install -DskipITs=false &&  cp seqware-pipeline/target/seqware ~/bin &&  mvn -B clean install -pl seqware-ext-testing -DskipITs=false -P 'extITs,embeddedTomcat'"

after_success:
- docker pull seqware/documentation_builder:1.2
- docker run -v id_seqware-jenkins-docker:/root/.ssh/private_key.pem seqware/documentation_builder:1.2 sh -c 'chown -R root /root/.ssh && chmod -R 600 /root/.ssh/* && eval `ssh-agent -s`  && ssh-add ~/.ssh/id_rsa &&  git pull && git checkout develop && locale && export LC_ALL="en_US.UTF-8" && export LANG="en_US.UTF-8" && locale && mvn clean install -DskipTests && mvn site-deploy'

# sudo required for docker based testing
sudo: required 
